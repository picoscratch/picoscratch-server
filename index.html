<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PicoScratch Server</title>
	<link rel="stylesheet" href="ui.css">
	<style>
		th, td {
			padding: 5px;
			text-align: center;
			border-radius: 10px;
		}
		th:nth-of-type(odd),
		td:nth-of-type(odd) {
			background-color: #2e2e2e;
		}
		input {
			background-color: #1d1d1d;
			font-size: 1.5rem;
			padding-left: 5px;
			color: white;
			border-style: solid;
			border-color: #2e2e2e;
			border-radius: 10px;
		}
	</style>
</head>
<body style="margin: 0;">
	<div id="login" style="display: flex; height: 100vh; flex-direction: column; align-items: center; justify-content: center; gap: 5px;">
		<h1>PicoScratch Server</h1>
		<input type="password" placeholder="Password" id="pw" disabled>
	</div>
	<div style="display: flex; margin: 10px; gap: 15px; flex-direction: column; display: none; transform: scale(0) skew(90deg); opacity: 0; transition: transform 500ms, opacity 1s;" id="main">
		<div style="padding: 5px; background-color: #1d1d1d; border-color: #2e2e2e; border-width: 2px; border-style: solid; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
			<h1 style="margin: 0;">Leaderboard</h1>
			<table id="leaderboard" style="font-size: 1.5rem;"></table>
		</div>
		<div style="padding: 5px; background-color: #1d1d1d; border-color: #2e2e2e; border-width: 2px; border-style: solid; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 10px;">
			<h1 style="margin: 0;">Control</h1>
			<button id="start">Start Game</button>
			<button id="end">End Game</button>
		</div>
	</div>
	<script>
		let ws = new WebSocket("ws://" + location.host);
		let leaderboard = [];
		function renderLeaderboard() {
			while (document.getElementById("leaderboard").firstChild) {
				document.getElementById("leaderboard").removeChild(document.getElementById("leaderboard").lastChild);
			}
			const tr = document.createElement("tr");
			["Platz", "Name", "Level", "Quiz %", "Actions"].forEach(s => {
				const td = document.createElement("th");
				td.innerText = s;
				tr.appendChild(td);
			})
			document.getElementById("leaderboard").appendChild(tr);
			for(let i = 0; i < 10; i++) {
				if(!leaderboard[i]) break;
				const player = leaderboard[i];
				const tr = document.createElement("tr");
				const place = document.createElement("td");
				place.innerText = i + 1;
				tr.appendChild(place);
				const name = document.createElement("td");
				name.innerText = player.name;
				tr.appendChild(name);
				const level = document.createElement("td");
				level.innerText = player.level;
				tr.appendChild(level);
				const percentage = document.createElement("td");
				percentage.innerText = player.percentage;
				tr.appendChild(percentage);
				const actions = document.createElement("td");
				const kickAction = document.createElement("button");
				kickAction.innerHTML = "K";
				kickAction.addEventListener("click", () => {
					ws.send("kick " + player.name);
				})
				kickAction.title = "Kick " + player.name;
				actions.appendChild(kickAction);
				const deleteAction = document.createElement("button");
				deleteAction.innerHTML = "D";
				deleteAction.addEventListener("click", () => {
					ws.send("delete " + player.name);
				})
				deleteAction.title = "Delete " + player.name;
				actions.appendChild(deleteAction);
				tr.appendChild(actions);
				document.getElementById("leaderboard").appendChild(tr);
			}
		}
		document.querySelector("#pw").addEventListener("keypress", (e) => {
			if(e.key != "Enter") return;
			document.querySelector("#pw").disabled = true;
			ws.send("admin " + document.querySelector("#pw").value);
		})
		document.querySelector("#pw").focus();
		ws.addEventListener("open", () => {
			document.querySelector("#pw").disabled = false;
		})
		ws.addEventListener("message", (data) => {
			const msg = data.data.toString();
			if(msg == "declined") {
				document.querySelector("#pw").disabled = false;
				document.querySelector("#pw").value = "";
				console.log("Declined");
			} else if(msg.startsWith("approved")) {
				document.querySelector("#login").style.display = "none";
				document.querySelector("#main").style.display = "flex";
				setTimeout(() => {
					document.querySelector("#main").style.transform = "";
					document.querySelector("#main").style.opacity = "1";
				}, 100);
				leaderboard = JSON.parse(msg.split("approved ", 2)[1]);
				renderLeaderboard();
			} else if(msg.startsWith("update")) {
				leaderboard = JSON.parse(msg.split("update ", 2)[1]);
				renderLeaderboard();
			}
		})
		document.querySelector("#start").addEventListener("click", () => {
			ws.send("start");
		})
		document.querySelector("#end").addEventListener("click", () => {
			ws.send("end");
		})
	</script>
</body>
</html>